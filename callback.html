<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</title>
</head>
<body>
  <h2>üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠ + ‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Google...</h2>
  <div id="info" style="margin-top: 1em;"></div>

  <script>
    // ‡∏î‡∏∂‡∏á access_token ‡∏à‡∏≤‡∏Å URL
    const hash = window.location.hash.substring(1);
    const params = new URLSearchParams(hash);
    const accessToken = params.get("access_token");

    if (!accessToken) {
      document.getElementById("info").innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö access token";
      throw new Error("No access token");
    }

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Google People API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠ + ‡∏≠‡∏µ‡πÄ‡∏°‡∏•
    fetch("https://people.googleapis.com/v1/people/me?personFields=names,emailAddresses", {
      headers: {
        Authorization: "Bearer " + accessToken
      }
    })
    .then(res => res.json())
    .then(data => {
      const name = data.names?.[0]?.displayName || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠";
      const email = data.emailAddresses?.[0]?.value || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•";

      document.getElementById("info").innerHTML = `
        ‚úÖ ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì <b>${name}</b><br>
        üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•: ${email}<br><br>
        üëâ <a href="index.html?name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}">‡πÑ‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏¢</a>
      `;
    })
    .catch(err => {
      document.getElementById("info").innerText = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
    });
  </script>
</body>
</html>
